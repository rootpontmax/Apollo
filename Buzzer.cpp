#include "Buzzer.h"


////////////////////////////////////////////////////////////////////////////////////////////////////
CBuzzer::CBuzzer( const int pin ) :
	m_durationTimer( false ),
	m_pin( pin ),
	m_halfPeriodUS( 0 ),
	m_bIsWorking( false ),
	m_bIsUnderPower( false )
{
	//pinMode( m_pin, OUTPUT );
}
////////////////////////////////////////////////////////////////////////////////////////////////////
void CBuzzer::Play( const byte pwmCoef, const unsigned long durationUS )
{
	Stop();

	m_bIsWorking = true;
	m_durationTimer.Start( durationUS, false );
	analogWrite( m_pin, pwmCoef );
}
////////////////////////////////////////////////////////////////////////////////////////////////////
void CBuzzer::Stop()
{
	m_durationTimer.Stop();
	m_bIsUnderPower = false;
	m_bIsWorking = false;
	analogWrite( m_pin, 0 );
}
////////////////////////////////////////////////////////////////////////////////////////////////////
void CBuzzer::Tick()
{
	if( !m_bIsWorking )
		return;

	if( m_durationTimer.IsReady() )
	{
		Stop();
		return;
	}
}
////////////////////////////////////////////////////////////////////////////////////////////////////